import { faFolderOpen, faPlus } from '@fortawesome/free-solid-svg-icons'
import { IconButton, useModal } from '@keadex/keadex-ui-kit/cross'
import React from 'react'
import { dialog } from '@tauri-apps/api'
import { openProject as openProjectAPI } from '../../core/tauri-rust-bridge'
import { toast } from 'react-toastify'
import { MinaError } from '../../models/autogenerated/MinaError'
import { useTranslation } from 'react-i18next'
import { openProject as openProjectEvent } from '../../core/store/slices/project-slice'
import { useNavigate } from 'react-router-dom'
import { HOME_PROJECT } from '../../core/router/routes'
import { useAppDispatch } from '../../core/store/hooks'
import ModalCRUProject from '../../components/ModalCRUProject/ModalCRUProject'

/* eslint-disable-next-line */
export interface HomeProps {}

export const Home = React.memo((props: HomeProps) => {
  const { t } = useTranslation()
  const dispatch = useAppDispatch()
  const navigate = useNavigate()
  const { modal, showModal, hideModal } = useModal()

  function openProject(path: string) {
    openProjectAPI(path)
      .then((project) => {
        dispatch(openProjectEvent(project))
        navigate(HOME_PROJECT)
      })
      .catch((error: MinaError) => {
        toast.error(
          t('common.error.project_not_opened', { errorMessage: error.msg }),
        )
      })
  }

  function handleOpenProject() {
    dialog.open({ directory: true }).then(async (path) => {
      if (Array.isArray(path)) toast.error(t('common.error.invalid_path'))
      else if (path) {
        openProject(path)
      }
    })
  }

  function handleCreateProject() {
    showModal({
      id: 'createProjectModal',
      title: `${t('home.create_project')}`,
      body: (
        <ModalCRUProject
          hideModal={hideModal}
          mode="create"
          onProjectCreated={openProject}
        />
      ),
      buttons: false,
    })
  }

  return (
    <div className="relative flex h-full w-full flex-col justify-center">
      {modal}
      <div className="-mt-28 text-center">
        <img
          src="mina-logo-full.svg"
          width={650}
          alt="Keadex Mina Logo "
          className="inline-block pointer-events-none"
        />
      </div>
      <div className="mt-20 text-center text-5xl">
        <IconButton
          icon={faFolderOpen}
          className="mr-20"
          onClick={handleOpenProject}
        >
          <span className="text-lg">{t('home.open_project')}</span>
        </IconButton>
        <IconButton icon={faPlus} onClick={handleCreateProject}>
          <span className="text-lg">{t('home.create_project')}</span>
        </IconButton>
      </div>
    </div>
  )
})

export default Home
